% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/score_functions.R
\name{calculate_factored_scaling}
\alias{calculate_factored_scaling}
\title{Calculate score using factored scaling (DIAGONAL PARAMETERIZATION ONLY)}
\usage{
calculate_factored_scaling(eta, tot_lik, X_t_prev, p_trans, fisher_info, K)
}
\arguments{
\item{eta}{Vector of regime likelihoods (length K)}

\item{tot_lik}{Total likelihood scalar}

\item{X_t_prev}{Previous filtered probabilities (length K)}

\item{p_trans}{Diagonal transition probabilities (p11, p22, ..., pKK) - length K}

\item{fisher_info}{Fisher Information scalar}

\item{K}{Number of regimes}
}
\value{
Scaled score vector (length K)
}
\description{
Calculate score using factored scaling (DIAGONAL PARAMETERIZATION ONLY)
}
\details{
IMPORTANT: This function is ONLY valid for diagonal parameterization (diag_probs=TRUE).
For off-diagonal parameterization, use apply_moore_penrose_scaling() instead.

This "factored" scaling method separates the score into two components:
\itemize{
\item Magnitude: S* = S / sqrt(I), where S is the likelihood ratio score
\item Direction: g-normalized, a unit vector encoding the gradient direction
}

The final score is computed as: scaled_score = S* Ã— g_normalized

This factorization has a natural interpretation: S* captures "how much news"
arrived, while g_normalized determines "which direction to update."

Implementation steps (matching HMMGAS C code in Filtering_2RegimesGAS.c):
\enumerate{
\item Calculate scalar S = (eta[1] - eta[K]) / tot_lik
\item Build g-vector with ALTERNATING SIGNS:
\itemize{
\item g[1] = +X_t_prev[1] * p11 * (1-p11)  (positive)
\item g[2] = -X_t_prev[2] * p22 * (1-p22)  (negative)
}
\item Normalize: g_normalized = g / ||g||
\item Scale: S_star = S / sqrt(fisher_info)
\item Final score = S_star * g_normalized
}

For K=2 with diag_probs=TRUE, this produces identical results to the
original HMMGAS C implementation. For K>2, this generalizes by using
S = (eta[1] - eta[K]) / tot_lik and alternating signs on the g-vector.
}
