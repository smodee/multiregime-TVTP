% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/score_functions.R
\name{calculate_gas_score}
\alias{calculate_gas_score}
\title{Calculate properly scaled GAS score vector}
\usage{
calculate_gas_score(
  y_obs,
  mu,
  sigma2,
  trans_prob,
  diag_probs = TRUE,
  X_pred,
  gh_setup,
  scaling_method = NULL,
  tot_lik_external = NULL
)
}
\arguments{
\item{y_obs}{Current observation at time t}

\item{mu}{Vector of regime means (length K)}

\item{sigma2}{Vector of regime variances (length K or 1 if equal_variances)}

\item{trans_prob}{Current transition probabilities (length K for diag_probs=TRUE, or K*(K-1))}

\item{diag_probs}{If TRUE, trans_prob contains diagonal elements (p11, p22, ...);
if FALSE, contains off-diagonal elements}

\item{X_pred}{Predicted probabilities before observation (length K)}

\item{gh_setup}{Gauss-Hermite quadrature setup from setup_gauss_hermite_quadrature()}

\item{scaling_method}{Method for scaling. Options: "factored", "simple", "normalized",
"moore_penrose". If NULL (default), auto-selects based on diag_probs:
"factored" for diagonal parameterization (matches HMMGAS),
"simple" for off-diagonal parameterization.

\if{html}{\out{<div class="sourceCode">}}\preformatted{   Scaling methods:
   \\itemize\{
     \\item "factored": Factors the score into magnitude (S*) times direction (g-normalized).
           Uses S* = S/sqrt(I) where S is the likelihood ratio score, and multiplies
           by a normalized g-vector that encodes gradient direction based on filtered
           probabilities and transition probabilities. This matches the original HMMGAS
           methodology and is recommended for diagonal parameterization.
     \\item "simple": Basic inverse Fisher scaling using 1/sqrt(I). General purpose.
     \\item "normalized": Normalizes the raw score vector to unit length, then scales
           by 1/sqrt(I). Treats all score components uniformly.
     \\item "moore_penrose": Uses Moore-Penrose pseudoinverse. EXPERIMENTAL - can cause
           optimization failures.
   \}
}\if{html}{\out{</div>}}}

\item{tot_lik_external}{Optional pre-computed total likelihood (for performance optimization)}
}
\value{
List with components:
\itemize{
\item scaled_score: Properly scaled score vector (length matches trans_prob)
\item fisher_info: Fisher Information scalar
\item raw_score: Raw (unscaled) score vector
}
}
\description{
Calculate properly scaled GAS score vector
}
\details{
Main interface function that combines all components of the GAS score calculation
following Bazzi et al. (2017). This function:
\enumerate{
\item Calculates regime likelihoods for the current observation
\item Computes the raw score vector (equation 13 in Bazzi et al.)
\item Calculates Fisher Information using Gauss-Hermite quadrature
\item Applies scaling (method depends on parameterization)
}

The resulting scaled score vector is used to update the time-varying parameters
in the GAS model: f_{t+1} = ω + A\emph{s_t + B}(f_t - ω)

This implementation generalizes the original 2-regime methodology to K regimes
while maintaining the mathematical foundation and numerical stability.

When diag_probs=TRUE, the default scaling_method is "factored", which produces
results identical to the original HMMGAS C implementation (Filtering_2RegimesGAS.c)
for K=2.
}
\examples{
# Setup for a 2-regime model with diagonal parameterization
y <- rnorm(200)
gh_setup <- setup_gauss_hermite_quadrature(y)

# Model parameters (diagonal parameterization)
mu <- c(-1, 1)
sigma2 <- c(0.5, 0.5)
trans_prob <- c(0.8, 0.9)  # p11, p22
X_pred <- c(0.6, 0.4)
y_obs <- 0.5

# Calculate scaled score (uses "factored" by default for diag_probs=TRUE)
result <- calculate_gas_score(y_obs, mu, sigma2, trans_prob,
                              diag_probs = TRUE, X_pred, gh_setup)
result$scaled_score  # The score vector
result$fisher_info   # Fisher Information
}
